<!DOCTYPE html>
<html>
<!--manifest="cache.app"-->
<head>
  <title>Green House</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/css/bootstrap.min.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.2.0/animate.min.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.0/css/toastr.min.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.0.0/css/bootstrap-datetimepicker.min.css" />

  <style type="text/css">
    /*body {
        padding-top: 80px;
      }*/
    ul > li > a.navlink {
      padding: 7px;
    }

    .green {
      color: green;
    }

    .yellow {
      color: yellow;
    }

    .red {
      color: #a94442;
    }

    /* page link */
    div[ng-view].ng-enter {
      -webkit-animation: fadeInRight 0.5s;
      animation: fadeInRight 0.5s;
    }

    /* ng-hide and ng-show */
    .ng-hide-remove {
      -webkit-animation: bounceIn 2.5s;
      animation: bounceIn 2.5s;
    }

    .ng-hide-add {
      -webkit-animation: flipOutX 2.5s;
      animation: flipOutX 2.5s;
      display: block !important;
    }
  </style>
</head>
<body>

  <div>

    <div data-ng-include="'header.html'"></div>

    <div class="container body-content ui-view-container" role="main" style="margin-bottom:50px;">
      <div ng-view data-ng-view-animate="zoomIn"></div>
    </div>

  </div>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.0/js/toastr.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.3.0/bootbox.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.8/angular.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.12/angular-sanitize.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.8/angular-route.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.12/angular-animate.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.12.0/ui-bootstrap-tpls.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-utils/0.1.1/angular-ui-utils.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.1/Chart.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.0.0/js/bootstrap-datetimepicker.min.js"></script>

  <script type="text/ng-template" id="header.html">
    <nav class="navbar navbar-default text-center">
      <div class="container">

        <div class="navbar-header text-center">
          <a class="navbar-brand" href="/#/"><i class="fa fa-leaf green"></i> Green House</a>
        </div>

        <ul class="nav navbar-nav navbar-right">
          <li><a ng-hide="layout.isLoggedIn" href="/#/admin"><i class="fa fa-wrench"></i> admin</a></li>
        </ul>
      </div>   <!-- /.container-fluid -->
    </nav>
  </script>

  <script type="text/ng-template" id="home.html">

    <div class="row">
      <div class="col-sm-6 table-responsive">
        <table class="table">
          <caption>User Options</caption>
          <tbody>
            <tr class="success">
              <td>

                <i class="fa fa-refresh fa-lg green" style="position:relative;top:10px; "></i>
                <span>2015 May 22 13:32:15</span><br />
                <small style="margin-left:20px;">Click to refresh new data</small>

              </td>
              <td>
                <div class="btn-group" role="group">
                  <span type="button" class="btn btn-primary active">C&deg;</span>
                  <span type="button" class="btn btn-default">F&deg;</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div><!-- /.col-sm-6 -->
      <div class="col-sm-6 table-responsive">
        <table class="table">
          <caption>System statistics</caption>
          <tbody>
            <tr class="success">
              <td><i class="fa fa-heartbeat green"></i> System running for <span>4 days</span> since last reboot </td>
            </tr>
            <tr class="success">
              <td><i class="fa fa-tachometer green"></i> System is healthy with <span>417</span>b or Free RAM</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-6 table-responsive">
        <table class="table">
          <caption>Air statistics</caption>
          <thead>
            <tr class="bg-primary"><td>Air</td><td> Out</td><td>In</td></tr>
          </thead>
          <tbody>
            <tr class="success"><td>Temperature</td><td><span class="badge">10 C&deg;</span></td><td><span class="label-success badge">10 C&deg;</span></td></tr>
            <tr class="success"><td>Humidity</td><td> <span class="badge">80 &#37;</span></td><td><span class="badge">80 &#37;</span></td></tr>
            <tr class="success"><td>Heat Index</td><td> <span class="badge">32 </span></td><td><span class="badge">32 </span></td></tr>
            <tr class="success"><td>Light</td><td> <span class="badge">780 lux</span></td><td><span class="badge">780 lux</span></td></tr>
          </tbody>
        </table>
      </div><!-- /.col-sm-6 -->
      <div class="col-sm-6  table-responsive">
        <table class="table">
          <caption>Water Statistics</caption>
          <thead>
            <tr class="bg-primary"><td>Water</td><td></td></tr>
          </thead>
          <tbody>
            <tr class="success"><td>Pool Level</td><td><span class="badge">5 m</span></td></tr>
            <tr class="success"><td>Top Temperature</td><td><span class="badge">12 C&deg;</span></td></tr>
            <tr class="success"><td>Bottom Temperature</td><td><span class="badge">12 C&deg; </span></td></tr>
            <tr class="success"><td>Pump Running</td><td><i class="fa fa-cog fa-spin fa-lg green"></i></td></tr>
          </tbody>
        </table>

      </div><!-- /.col-sm-6 -->
    </div><!--/row-->

    <div class="row">
      <div class="col-sm-6 table-responsive">
        <table class="table">
          <caption>Bed statistics</caption>
          <thead>
            <tr class="bg-primary"><td>Bed</td><td> Level</td><td></td></tr>
          </thead>
          <tbody>
            <tr class="success"><td>BED A</td><td><span class="badge">1</span></td><td><span class="label-success badge">10 C&deg;</span></td></tr>
            <tr class="success"><td>BED B</td><td><span class="badge">1</span></td><td><span class="badge">80 &#37;</span></td></tr>
            <tr class="success"><td>BED C</td><td><span class="badge">1 </span></td><td><span class="badge">32 </span></td></tr>
            <tr class="success"><td>BED D</td><td><span class="badge">1</span></td><td><span class="badge">780 lux</span></td></tr>
            <tr class="success"><td>BED A</td><td><span class="badge">2</span></td><td><span class="label-success badge">10 C&deg;</span></td></tr>
            <tr class="success"><td>BED B</td><td><span class="badge">2</span></td><td><span class="badge">80 &#37;</span></td></tr>
            <tr class="success"><td>BED C</td><td><span class="badge">2</span></td><td><span class="badge">32 </span></td></tr>
            <tr class="success"><td>BED D</td><td><span class="badge">2</span></td><td><span class="badge">780 lux</span></td></tr>
          </tbody>
        </table>
      </div><!-- /.col-sm-6 -->
      <div class="col-sm-6  table-responsive">
        <table class="table">
          <caption>Tower Statistics</caption>
          <thead>
            <tr class="bg-primary"><td>Tower</td><td></td></tr>
          </thead>
          <tbody>
            <tr class="success"><td>Tower 1</td><td><span class="badge">5 m</span></td></tr>
            <tr class="success"><td>Tower 2</td><td><span class="badge">5 m</span></td></tr>
            <tr class="success"><td>Tower 3</td><td><span class="badge">5 m</span></td></tr>
            <tr class="success"><td>Tower 4</td><td><span class="badge">5 m</span></td></tr>
            <tr class="success"><td>Tower 5</td><td><span class="badge">5 m</span></td></tr>
            <tr class="success"><td>Tower 6</td><td><span class="badge">5 m</span></td></tr>
            <tr class="success"><td>Tower 7</td><td><span class="badge">5 m</span></td></tr>
            <tr class="success"><td>Tower 8</td><td><span class="badge">5 m</span></td></tr>

          </tbody>
        </table>

      </div><!-- /.col-sm-6 -->
    </div><!--/row-->

  </script>

  <script type="text/ng-template" id="login.html">

    <div class="row">
      <div class="col-sm-12">

        <table class="table">
          <caption> Enter Credentials</caption>
          <tbody>
            <tr class="success">
              <td>
                <form class="form">
                  <div class="form-group">
                    <label class="sr-only" for="user">Username</label>
                    <input type="username" class="form-control" id="user" placeholder="Username">
                  </div>
                  <div class="form-group">
                    <label class="sr-only" for="pass">Password</label>
                    <input type="password" class="form-control" id="pass" placeholder="Password">
                  </div>
                  <div class="form-group">
                    <div class="">
                      <button type="submit" class="btn btn-primary">Login</button>
                    </div>
                  </div>
                </form>
              </td>
            </tr>

          </tbody>
        </table>

      </div>
    </div>

  </script>

  <script type="text/ng-template" id="admin.html">

    <!-- System status -->
    <div class="row">
      <div class="col-sm-12">
        <table class="table">
          <caption> System status</caption>
          <tbody>
            <tr>
              <td class="success">

                <div class="row">
                  <div class="col-sm-4">
                    <i class="fa fa-rocket green fa-lg"></i> System running for <strong><span class="green">4 days</span></strong> since last reboot
                  </div>
                  <div class="col-sm-4">
                    <i class="fa fa-bar-chart green fa-lg"></i> System is healthy with <strong><span class="green">417b</span></strong> to <strong><span class="green">513b</span></strong> of Free RAM
                  </div>
                  <div class="col-sm-4">
                    <i class="fa fa-recycle green fa-lg"></i> System has been booted <strong><span class="green">51</span></strong> times since <span class="green">Feb 5 2015</span>
                  </div>
                </div>

              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!--Change Settings-->
    <div class="row">
      <div class="col-sm-12">

        <table class="table">
          <caption> System Settings</caption>
          <tbody>
            <tr class="success">
              <td>
                <div class="row">
                  <!-- Log Settings -->
                  <div class="col-sm-4">
                    <form class="form">
                      <div class="form-group">
                        <label>Change Log Settings</label>
                      </div>
                      <div class="form-group">
                        <div class="checkbox">
                          <label>
                            <input type="checkbox" ng-model="LogHttp">
                            Log http request in log file
                          </label>
                        </div>
                        <div class="checkbox">
                          <label>
                            <input type="checkbox" ng-model="LogRAM">
                            Log RAM usage in session log file
                          </label>
                        </div>
                        <div class="checkbox">
                          <label>
                            <input type="checkbox" ng-model="BootNoSD">
                            Reboot if SD not present
                          </label>
                        </div>
                        <div class="checkbox">
                          <label>
                            Set Sensor log frequency:
                            <select class="form-control" ng-model="SensorLogFreq"
                                    ng-options="opt as opt.label for opt in sensorFreqOptions"></select>
                            <!--<select class="form-control">
                              <option value="0">10 min</option>
                              <option value="1">30 min</option>
                              <option value="2">60 min</option>
                            </select>-->
                          </label>
                        </div>
                      </div>
                      <button type="submit" class="btn btn-primary">Submit</button>
                      {{settings}}, {{time}}
                    </form>
                  </div>
                  <!-- Date Time -->
                  <div class="col-sm-4">
                    <form class="form">
                      <div class="form-group">
                        <label>Change Device Time</label>
                      </div>
                      <div class="form-group">
                        <strong><span class="green">2015 May 22 13:42:22 </span></strong>
                      </div>
                      <div class="form-group">
                        <label class="sr-only" for="newDateTime">New Time</label>
                        <div class="input-group" id="dateTmePicker" ui-datepicker ng-model="data.date">
                          <!--<div class="input-group-addon">$</div>-->
                          <input type="text" class="form-control" id="newDateTime" placeholder="Set new time" />
                          <div class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></div>
                        </div>
                      </div>
                      <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                  </div>
                  <!-- Password -->
                  <div class="col-sm-4">
                    <form class="form">
                      <div class="form-group">
                        <label>Change your password</label>
                      </div>
                      <div class="form-group">
                        <label class="sr-only" for="currentPass">Current Password</label>
                        <input type="email" class="form-control" id="currentPass" placeholder="Current Password">
                      </div>
                      <div class="form-group">
                        <label class="sr-only" for="newPass">New Password</label>
                        <input type="password" class="form-control" id="newPass" placeholder="Password">
                      </div>
                      <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                  </div>
                </div>
              </td>
            </tr>


            <!--<tr class="TO TO">
              <td><i class="fa fa-tachometer green"></i> Set Sensor ranges - triger actions</td>
              <td><i class="fa fa-tachometer green"></i> Auto Fish Feeder</td>
              <td><i class="fa fa-tachometer green"></i> Send Email</td>
              <td><i class="fa fa-tachometer green"></i> Send Text (https://www.twilio.com/sms/pricing)</td>
              <td><i class="fa fa-tachometer green"></i> Change IP and MAC address (maybe i can change port too but harder?)[need to reboot after change]</td>
            </tr>-->
          </tbody>
        </table>

      </div>
    </div>

    <!--Maintenance-->
    <div class="row">
      <div class="col-sm-12">
        <table class="table">
          <caption> Maintenance</caption>
          <tbody>
            <tr class="success">
              <td><i class="fa fa-tachometer green"></i> View files (Links) READY</td>
              <td><i class="fa fa-tachometer green"></i> View sessions ADMIN</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!--Reboot-->
    <div class="row">
      <div class="col-sm-12">
        <table class="table">
          <caption> Reboot Device</caption>
          <tbody>
            <tr class="success">
              <td>
                <div class="row">
                  <div class="col-sm-12 text-center">
                    <button type="button" class="btn btn-danger" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"><i class="fa fa-power-off"></i> Reboot</button>
                    <div class="collapse" id="collapseExample">
                      <div class="well warning">
                        <div class="row">
                          <div class="col-xs-12">
                            Are you sure?
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-xs-3">
                          </div>
                          <div class="col-xs-2">
                            <button type="button" class="btn btn-success btn-lg" data-target="#collapseExample" data-toggle="collapse">No</button>
                          </div>
                          <div class="col-xs-2">
                          </div>
                          <div class="col-xs-2">
                            <button type="button" class="btn btn-danger btn-lg">Yes</button>
                          </div>
                          <div class="col-xs-3">
                          </div>
                          </row>
                        </div>
                      </div>
                    </div>
                  </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </script>

  <script id="routing">
    angular.module('greenhouse', ['ngRoute', 'ngAnimate']).
      config(['$routeProvider', function ($routeProvider) {
        $routeProvider.
         when("/", { templateUrl: "home.html", controller: "homeController" }).
         when("/admin", { templateUrl: "admin.html", controller: "adminController" }).
         when("/login", { templateUrl: "login.html", controller: "loginController" }).
         otherwise({ redirectTo: '/' });

      }])
  </script>
  <script id="service">
    angular.module('greenhouse').
      service("greenApiService", ['$http', '$q', function ($http, $q) {

        var host = 'http://miticv.duckdns.org:8080';
        sessionStorage.setItem('pass', '44444'); //for testing only!!

        return ({

          //getSensorData: getSensorData,
          //getHistoryLog: getHistoryLog,
          //getMonthData: getMonthData,
          //getYearData: getYearData,
          //viewFiles: viewFiles,

          isAdmin: isAdmin,

          setSettings: setSettings,
          getSettings: getSettings,

          getTime: getTime,
          setTime: setTime,

          doReboot: doReboot
        });

        //#region IsAdmin
        function isAdmin(pin) {

          $http({
            method: "get",
            url: host + '/pin?U=' + pin
          }).sucess(function (data) {
            if (data.data == 1) {
              sessionStorage.setItem('pass', pin);
              return true;
            } else {
              sessionStorage.removeItem('pass');
              return false;
            }
          }).error(function () {
            sessionStorage.removeItem('pass');
            return false;
          });
        }
        //#endregion
        //#region doReboot
        function doReboot() {

          return $http({
            method: "put",
            headers: { 'PP': sessionStorage.getItem('pass') },
            url: host + '/reboot'
          });
        }
        //#endregion
        //#region setSettings
        function setSettings(settings) {

          return $http({
            method: "put",
            headers: { 'PP': sessionStorage.getItem('pass') },
            url: host + '/settings?U=' + settings
          });
        }
        //#endregion
        //#region getSettings
        function getSettings() {

          return $http({
            method: "get",
            headers: { 'PP': sessionStorage.getItem('pass') },
            url: host + '/file/SETTINGS.TXT'
          });
        }
        //#endregion
        //#region getTime
        function getTime() {

          return $http({
            method: "get",
            headers: { 'PP': sessionStorage.getItem('pass') },
            url: host + '/clock'
          });
        }
        //#endregion
        //#region setTime
        function setTime(year, month, day, hour, min, sec, week) {

          return $http({
            method: "put",
            headers: { 'PP': sessionStorage.getItem('pass') },
            url: host + '/clock?U=' + year + month + day + hour + min + sec + week
          });
        }
        //#endregion
      }]);


    angular.module('greenhouse').
      value('toastr', toastr).
      factory('NotifierService',
      ['toastr', '$window', '$log',
      function NotifierService(toastr, $window, $log) {
        'use strict';

        toastr.options.timeOut = 5000;
        toastr.options.positionClass = 'toast-bottom-right';


        function notify(type) {
          return function (message, title) {
            toastr[type](message, title);
            //$log.debug(type + ':', message);
          };
        }

        return {
          error: notify('error'),
          info: notify('info'),
          success: notify('success'),
          warning: notify('warning')
        };
      }]);
  </script>
  <script id="home">
    angular.module('greenhouse').
      controller('homeController', ['$scope', 'greenApiService', function ($scope, greenApiService) {

        //$scope.getData = function () {
        //  greenApiService.getSensorData();
        //};

      }]);

  </script>
  <script id="admin">

    angular.module('greenhouse').
      controller('adminController', ['$scope', 'greenApiService', 'NotifierService', function ($scope, greenApiService, NotifierService) {

        $scope.settings = '';
        $scope.time = '';
        $scope.sensorFreqOptions = [
          { label: '10 min', value: 0 },
          { label: '10 min', value: 1 },
          { label: '60 min', value: 2 }
        ];

        $scope.LogHttp = false;
        $scope.LogRAM = false;
        $scope.BootNoSD = false;
        $scope.SensorLogFreq = $scope.sensorFreqOptions[1];
        $scope.error = '';



        greenApiService.getSettings().then(
          function success(data) {
            $scope.settings = data.data;
            sessionStorage.setItem('pass', $scope.settings.substring(0, 4)); //make usre pass is current!
            $scope.LogHttp = $scope.settings.substring(4, 5) === '1';
            $scope.SensorLogFreq = $scope.sensorFreqOptions[$scope.settings.substring(5, 6)];
            $scope.LogRAM = $scope.settings.substring(6, 7) === '1';
            $scope.BootNoSD = $scope.settings.substring(7, 8) === '1';
            NotifierService.info("text", "title");
          },
          function error(e) {
            $scope.error += "can not load settings.";
          });

        greenApiService.getTime().then(
          function success(data) {
            $scope.time = data.data.datetime;
          },
          function error(e) {
            $scope.error += "can not load time.";
          });

      }]);

  </script>
  <script id="directive">

    angular.module('greenhouse').
      directive('uiDatepicker', function uiDatepickerDirective() {
        'use strict';

        function link(scope, el, attr, ngModel) {
          var input = el.find('input');
          $(el).datetimepicker({
            sideBySide: true,
            showTodayButton: true,
            useCurrent: true
          });
          input.on('blur keyup change', function () {
            ngModel.$setViewValue(input.val());
            console.log(input.val());
          });
        }

        return {
          restrict: 'A',
          require: 'ngModel',
          link: link
        };
      });

  </script>

  <script id="startup">
    $(document).ready(function () {
      angular.bootstrap(document, ['greenhouse']);
    });
  </script>

</body>
</html>